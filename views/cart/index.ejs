<!-- <!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Your Cart</title>
        <style>
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #ddd; padding: 8px; }
            th { text-align: left; }
            .right { text-align: right; }
            form { display: inline; }
        </style>
    </head>
    <body>
        <h1>Your Cart</h1>
        <p><a href="/products>← Continue shopping</a></p>
        <% const items = Object.values(cart.items || {}); %>
        <% if (items.length === 0) { %>
         <p>Your cart is empty.</p>
         <form method="post" action="/cart/clear"><button type="submit">Clear Cart</button></form>
        <% } else { %>
        <table>
            <thead>
                <tr>
                    <th>Name</th>th><th class="right">Unit Price</th>th><th class="right">Qty</th>th><th class="right">Line</th><th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% items.forEach(item => { %>
                <tr>
                    <td><%= item.name %></td>
                    <td class="right">¥<%= item.price.toFixed(2) %></td>
                    <td class="right"><%= item.qty %></td>
                    <td class="right">¥<%= (item.qty * item.price).toFixed(2) %></td>
                    <td>
                        <form method="post" action="/cart/<%= item.productId %>/increase"><button></button>+</form></button></form>
                        <form method="post" action="/cart/<%= item.productId %>/decrease"><button>-</button></form>
                        <form method="post" action="/cart/<%= item.productId %>/remove"><button>Remove</button></form>
                    </td>
                </tr>
            <% }) %>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="right">Subtotal</th>
                    <th class="right">¥<%= cart.subtotal.toFixed(2) %></th>
                    <th></th>
                </tr>
            </tfoot>
        </table>}

        <p>
            <form method="post" action="/orders"><button type="submit">Submit Order</button></form>
            <form method="post" action="/cart/clear"><button type="submit">Clear Cart</button></form>
        </p>
        <% } %>
    </body>
</html> -->

<!-- views/cart/index.ejs -->
<%- include('../partials/header') %>

<% const C = (cart && Array.isArray(cart.lines)) ? cart : { lines: [], total: 0, count: 0 }; %>

<h1>Your Cart</h1>

<% if (C.lines.length === 0) { %>
  <p>Your cart is empty.</p>
  <p><a href="/products">Back to products</a></p>
<% } else { %>
  <table border="1" cellpadding="8">
    <thead>
      <tr><th>Item</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr>
    </thead>
    <tbody>
      <% C.lines.forEach(line => { %>
        <tr>
          <td>
            <img src="<%= line.imageUrl || '/img/placeholder.png' %>" width="40" onerror="this.src='/img/placeholder.png'"/>
            <%= line.name %>
          </td>
          <td>¥<%= yen(line.price) %></td>
          <td>
            <form action="/cart/qty/<%= line.id %>" method="POST" style="display:inline-flex;gap:6px">
              <input type="number" name="qty" min="0" value="<%= line.qty %>" style="width:60px" />
              <button type="submit">Update</button>
            </form>
          </td>
          <td>¥<%= yen(line.subtotal) %></td>
          <td>
            <form action="/cart/remove/<%= line.id %>" method="POST">
              <button type="submit">Remove</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3" style="text-align:right">Total:</th>
        <th>¥<%= C.total.toLocaleString() %></th>
        <th></th>
      </tr>
    </tfoot>
  </table>

  <form action="/checkout" method="POST" style="margin-top:16px">
    <button type="submit">Proceed to Checkout</button>
  </form>
<% } %>

